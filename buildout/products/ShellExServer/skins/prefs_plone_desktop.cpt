<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="here/prefs_main_template/macros/master"
      i18n:domain="plone">

  <metal:block metal:fill-slot="top_slot"
               tal:define="dummy python:request.set('disable_border', 1)" />

  <body>

    <div metal:fill-slot="prefs_configlet_main"
         i18n:domain="plone_desktop"
         tal:define="
            utils python: modules['Products.ShellExServer.utils'];
            info python:utils.getDesktopLicenseInfo(context);
            expires info/expires|python:True;
            daysLeft info/daysLeft|python:0">

      <h1 i18n:translate="heading_setup">Enfold Desktop Setup</h1>

      <a href=""
         class="link-parent"
         tal:attributes="href string: $portal_url/plone_control_panel"
         i18n:translate="label_up_to_plone_setup">
        Up to Site Setup
      </a>

      <h2>License</h2>

     <span tal:condition="info">
    <p tal:condition="python: not expires and daysLeft &lt; 30" class="portalMessage">Your Enfold Desktop license will stop working in <em tal:content="daysLeft"></em> days.</p>
     <ul>
      <tal:block condition="expires">
        <li>Days left in license: <b tal:content="daysLeft"></b></li>
      </tal:block>
      <tal:block condition="not: expires">
        <li><b>Unlimited License</b></li>
      </tal:block>
     </ul>
    </span>

    <p tal:condition="not: info">No license can be found for Enfold
    Desktop, this might mean your license has expired. You will be
    able to use Enfold Desktop, but it will display Ads.</p>

      <p>If have any questions regarding the licensing information
      above, then please contact us at <a
      href="mailto:license@enfoldsystems.com">license@enfoldsystems.com</a>. For
      the purchase of Enfold Desktop licenses, please contact <a
      href="mailto:sales@enfoldsystems.com">sales@enfoldsystems.com</a></p>

      <h2>Setup</h2>

      <form action=""
            name="reconfig"
            method="post"
            tal:attributes="action string:prefs_plone_desktop"
            tal:define="properties python:here.portal_properties.plone_desktop_uri;
                        errors options/state/getErrors">
        <fieldset>
          <legend i18n:translate="legend_details">Settings</legend>

          <div class="field"
               tal:define="filename_normalization request/filename_normalization |
			   properties/filename_normalization | nothing;
			   relaxed_normalization request/relaxed_normalization |
			   properties/relaxed_normalization | nothing">
            <label i18n:translate="label_filename_normalization">
              Filename Normalization
            </label>

            <div class="formHelp" i18n:translate="help_filename_normalization">
              If you have non-ascii filenames then this will rename
              the filename so that it contains an english ascii
              spelling of the file. It also alters spaces, underlines
              and lower cases file names.

              The original filename is not
              stored. <strong>Note:</strong> If you do not have this
              option enabled then files with non-ascii filenames
              cannot be uploaded.
            </div>

            <input
                  id="filename_normalization"
                  name="filename_normalization"
                  value="relaxed_normalization"
                  type="radio"
                  tal:attributes="checked relaxed_normalization" />
                  <label for="relaxed_normalization">Change only non-ascii characters in file names</label><br />

            <input
                  id="relaxed_normalization"
                  name="filename_normalization"
                  value="filename_normalization"
                  type="radio"
                  tal:attributes="checked python:filename_normalization and not relaxed_normalization" />
                  <label for="relaxed_normalization">Change non-ascii, alter spaces, lower case the text and perform other fixes in file names</label><br />


            <input
                  id="no_changes"
                  name="filename_normalization"
                  value=""
                  type="radio"
                  tal:attributes="checked not: python: filename_normalization or relaxed_normalization" />
                  <label for="no_changes">No changes</label><br />
          </div>


          <div class="field"
               tal:define="external_editor_optimize request/external_editor_optimize | 
			   properties/external_editor_optimize | nothing;
			   external_editor_optimize python: external_editor_optimize is nothing and True or external_editor_optimize">
            <label i18n:translate="label_external_editor_optimize">
              External Editor Optimization
            </label>

            <div class="formHelp" i18n:translate="help_external_editor_optimize">
	      Check this if none of your users will be using the
	      External Editor. Do not check this if External Editor
	      will be used.
            </div>

            <input
                  id="external_editor_optimize"
                  name="external_editor_optimize:boolean"
                  value="1"
                  type="checkbox"
                  tal:attributes="checked python:external_editor_optimize and 'checked' or nothing" />
                  <label for="external_editor_optimize">
                     Optimize External Editor for Enfold Desktop?
                  </label>

          </div>

          <div class="field"
               tal:define="blacklist_types request/blacklist_types | properties/blacklist_types | python:('Topic',)">
            <label i18n:translate="label_blacklist_types">
	      Blacklist Types
            </label>

            <div class="formHelp" i18n:translate="help_blacklist_types">
	      The types you select as blacklist types here will be
	      hidden from WebDAV clients.
            </div>

            <select
                  id="blacklist_types"
                  name="blacklist_types:list"
		  multiple="multiple">
	      <option tal:repeat="ti here/portal_types/listTypeInfo" 
		      tal:attributes="selected python:ti.getId() in blacklist_types or nothing;
				      value ti/getId"
		      tal:content="python:ti.Title()" />
	    </select>

          </div>

          <div class="field"
               tal:define="show_portal_tools request/show_portal_tools | properties/show_portal_tools | nothing">
            <label i18n:translate="label_show_portal_tools">
              Show Portal Tools
            </label>

            <div class="formHelp" i18n:translate="help_show_portal_tools">
              If you enable this setting users with the
              <strong>Manager</strong> role will be allowed to see the
              tools in the portal root. Otherwise, only the portal
              content will be shown.
            </div>

            <input
                  id="show_portal_tools"
                  name="show_portal_tools:boolean"
                  value="1"
                  type="checkbox"
                  tal:attributes="checked python:show_portal_tools and 'checked' or nothing" />
                  <label for="show_portal_tools">
                     Show portal tools for users with the
                     <strong>Manager</strong> role?
                  </label>

          </div>

          <div class="formControls">
            <input class="context"
                   tabindex=""
                   type="submit"
                   name="form.button.submit"
                   value="Save"
                   i18n:attributes="value"
                   tal:attributes="tabindex tabindex/next;"
                   />
          </div>

        </fieldset>

        <fieldset>
          <legend i18n:translate="legend_session_roots">Session for Enfold Desktop</legend>

          <p>When Enfold Desktop opens a file, it creates a session to the Enfold Server. From that location you can browse the Enfold Server site, it normally makes sense to have this as close as possible to the root of your site.</p>
          <p>Enfold Desktop will choose the location for the session that is <strong>closest</strong> to the file being edited. The default root for any session is the root of your site, this takes into account any virtual hosting you might have.</p>

          <div class="field"
               tal:define="submitted python:request.get('form.submitted', None);
                           member_folder properties/use_member_folder_session|python:True;
                           member_folder python:submitted and request.get('member_folder', False) or (not submitted and member_folder);">

            <input type="checkbox"
                    id="member_folder_checkbox"
                   name="member_folder"
                   tal:attributes="checked member_folder"
                   value="member_folder"/><label for="member_folder_checkbox">Members home folder</label>
                   <div class="formHelp">If this option is enabled
then the user's home folder will be added to the list of <b>default
session roots</b>. If user <em>bob</em> logged in and
opens a session anywhere below his home folder, a session pointing
to <em>/Members/bob</em> will be created.</div>
          </div>

          <label i18n:translate="label_custom_sessions">
              Custom sessions
            </label>

          <div class="field"
               tal:attributes="class python:error and 'field error' or 'field'"
               tal:define="error errors/configured_sessions|nothing;
                           configured_sessions properties/configured_sessions|nothing;
                           configured_sessions request/configured_sessions|python:configured_sessions and '\n'.join(configured_sessions) or ''">
            <div class="formHelp">You can also enter custom sessions one per line. Enter session paths in the form /folder1/folder2 relative to the Plone site root. The order of these sessions is not important. Each session will be added to the list of session roots looked up.</div>
            <div tal:content="error">Validation error output</div>
            <textarea rows="10" name="configured_sessions" tal:content="configured_sessions"></textarea>
          </div>

          <div class="formControls">
            <input class="context"
                   tabindex=""
                   type="submit"
                   name="form.button.submit_sessions"
                   value="Save"
                   i18n:attributes="value"
                   tal:attributes="tabindex tabindex/next;"
                   />
          </div>
        </fieldset>

        <input type="hidden" name="form.submitted" value="1" tal:attributes="value template/id" />

      </form>
    </div>

  </body>
</html>


